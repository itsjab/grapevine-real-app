import { anthropic } from '@ai-sdk/anthropic';
import { generateText } from 'ai';

export async function generateVarietalGuide(variety: string) {
  const { text } = await generateText({
    model: anthropic('claude-4-sonnet-20250514'),
    maxTokens: 20000,
    temperature: 1,
    system: 'You are a master of wine, writing grape varietal guides.',
    messages: [
      {
        role: 'user',
        content: [
          {
            type: 'text',
            text: "<examples>\n<example>\n<GRAPE_VARIETY>\nRiesling\n</GRAPE_VARIETY>\n<ideal_output>\n# Riesling\n\n## Growing Regions\nRiesling is a cool climate grape variety that prefers steep slopes. In Germany, Riesling is cultivated in all wine-growing regions. In Alsace, Riesling is the most important grape variety alongside Pinot Blanc and Gewürztraminer, grown in numerous Grand Cru sites.\nIn Austria, Riesling thrives along the Danube in the DACs Wachau, Kremstal and Kamptal and on the steep slopes of Styria.\nIn the New World, high-quality Riesling wines are produced in Australia (Clare Valley and Eden Valley) and the US states of New York (Finger Lakes) and Michigan.\n\n## Wine Styles\nRiesling is vinified into dry, semi-dry (off-dry) and fruity sweet wines. It is typically produced without oak. Sweet wines in particular have great aging potential. Aged Trockenbeerenauslese (noble rot selection) are among the most expensive wines in the world.\n\n**Dry**\nDry Rieslings often exhibit vibrant acidity and intense fruit aromas that vary depending on the ripeness of the grapes.\n\n**Semi-dry**\nOff-dry Rieslings thrive on the balance between subtle residual sweetness and lively acidity, accompanied by characteristic aromas such as peach, apricot and delicate citrus notes.\n\n**Fruity sweet**\nA fruity sweet Riesling is characterized by a distinctly noticeable, natural sweetness and offers intense aromas of ripe fruits such as apricot, peach and honeydew melon, often accompanied by honey notes. The high acidity provides freshness and balance.\n\n**Sparkling wine**\nRiesling is increasingly used for sparkling wine production. Riesling sparkling wine is typically fresh and crisp, with high acidity and intense fruit notes. This makes it suitable as a food companion.\n\n## Tasting Profile\nRiesling typically produces wines with high acidity and intense fruit aromas. Notes of citrus fruits, stone fruits and exotic fruits are typical. Many Rieslings have a mineral note, and aged wines can exhibit petrol notes.\n\n**Color spectrum:** Usually greenish-yellow to golden yellow,depending on maturity\n**Acidity:** high\n**Body:** light\n**Fruit aromas:**\n* green fruit: green apple, green pear\n* citrus fruits: lemon, lime\n* tropical fruit: pineapple, honeydew melon\n* stone fruit: peach, apricot, nectarine\n\n**Other aromas:**\nspices: honey, ginger\nfloral: citrus blossoms\nother: petrol, kerosene, flint, wax\n\n**Aromas from bottle aging:**\nspices: honey, ginger\nother: petrol\n\n## Other grape varieties you might like\nIf you enjoy Riesling, try these varieties:\n* [Gewürztraminer](/varieties/gewuerz-traminer) - Similar aromatic profile\n* [Chenin Blanc](/varieties/chenin-blanc) - Comparable acidity and versatility\n* [Grüner Veltliner](/varieties/gruener-veltliner) - Similar mineral character\n* [Albariño](/varieties/albarinho) - Comparable citrus profile and acidity\n</ideal_output>\n</example>\n<example>\n<GRAPE_VARIETY>\nGamay\n</GRAPE_VARIETY>\n<ideal_output>\n# Gamay\\n## Growing Regions\\nGamay is primarily associated with the Beaujolais region in France, where it produces the famous Beaujolais wines across ten crus including Morgon, Moulin-à-Vent, and Fleurie. The grape thrives in the granite soils of northern Beaujolais and the clay-limestone soils of the south.\\n\\nOutside of Beaujolais, Gamay is cultivated in the Loire Valley, particularly in Touraine, where it produces fresh, everyday wines. Small plantings exist in Switzerland's Valais region and parts of eastern France. In the New World, Gamay can be found in cooler regions of California, Oregon, and Ontario, Canada, though plantings remain limited.\\n\\n## Wine Styles\\nGamay is typically vinified using carbonic maceration or semi-carbonic maceration, which preserves the grape's fresh fruit character and results in wines with bright color and low tannins. Most Gamay wines are meant for early consumption, though some cru Beaujolais can age for several years.\\n\\n**Beaujolais Nouveau**\\nReleased just weeks after harvest, these wines showcase Gamay's bright, fresh fruit character with banana and bubble gum notes from the carbonic maceration process.\\n\\n**Beaujolais Villages**\\nMore structured than Nouveau, these wines offer greater depth while maintaining Gamay's characteristic lightness and food-friendly nature.\\n\\n**Cru Beaujolais**\\nThe ten crus produce more complex expressions of Gamay, with varying characteristics depending on terroir. Some, like Morgon and Moulin-à-Vent, can develop earthy, more structured profiles with age.\\n\\n## Tasting Profile\\nGamay produces light to medium-bodied wines with high acidity and low tannins. The wines are known for their bright fruit character and food-friendly nature, making them excellent companions to a wide range of dishes.\\n\\n**Color spectrum:** Light to medium ruby red, often with purple highlights\\n**Acidity:** high\\n**Body:** light to medium\\n**Tannins:** low to medium\\n\\n**Fruit aromas:**\\n* red fruit: cherry, raspberry, strawberry, cranberry\\n* dark fruit: blackberry (in structured examples)\\n\\n**Other aromas:**\\n* floral: violet, peony\\n* spices: white pepper, cinnamon\\n* earthy: granite, wet leaves, forest floor\\n* other: banana, bubble gum (from carbonic maceration)\\n\\n**Aromas from bottle aging:**\\n* earthy: leather, tobacco, game\\n* spices: black pepper, clove\\n\\n## Other grape varieties you might like\\nIf you enjoy Gamay, try these varieties:\\n* [Pinot Noir](/varieties/pinot-noir) - Similar light body and red fruit character\\n* [Dolcetto](/varieties/dolcetto) - Comparable low tannins and food-friendly style\\n* [Cinsault](/varieties/cinsault) - Similar fresh, light-bodied profile\\n* [Barbera](/varieties/barbera) - Comparable high acidity and bright fruit\\n* [Zweigelt](/varieties/zweigelt) - Similar cherry notes and approachable style\n</ideal_output>\n</example>\n<example>\n<GRAPE_VARIETY>\nAlbarinho\n</GRAPE_VARIETY>\n<ideal_output>\n# Albariño\\n\\n## Growing Regions\\nAlbariño is primarily cultivated in the Rías Baixas region of Galicia in northwestern Spain, where it thrives in the Atlantic-influenced climate and granite soils. The grape performs exceptionally well in cool, maritime conditions with high humidity and moderate temperatures.\\n\\nIn Portugal, where it's known as Alvarinho, the variety is grown in the Vinho Verde region, particularly in the subregion of Monção e Melgaço. Here it produces both still and sparkling wines with distinctive mineral qualities.\\n\\nOutside the Iberian Peninsula, Albariño has found success in cool coastal regions of California, particularly in Monterey County and the Central Coast. Small plantings also exist in Oregon's Willamette Valley, Washington State, and parts of Australia's cooler wine regions.\\n\\n## Wine Styles\\nAlbariño is typically vinified as a dry white wine, though styles can vary from crisp and mineral-driven to richer and more textured depending on winemaking techniques.\\n\\n**Traditional Style**\\nClassic Albariño wines are fermented in stainless steel to preserve their fresh, vibrant character. These wines showcase pure fruit expression with bright acidity and distinctive mineral notes.\\n\\n**Premium Style**\\nHigher-end producers may use techniques such as lees contact, partial barrel fermentation, or extended skin contact to create wines with greater texture and complexity while maintaining the variety's characteristic freshness.\\n\\n**Sparkling**\\nIn the Vinho Verde region, Albariño is often made into lightly sparkling wines with a gentle effervescence that enhances the grape's natural freshness and food-pairing versatility.\\n\\n## Tasting Profile\\nAlbariño produces medium-bodied wines with high acidity and pronounced mineral character. The wines are known for their citrus-driven profile and excellent food-pairing capabilities, particularly with seafood.\\n\\n**Color spectrum:** Pale to medium lemon, often with greenish highlights\\n**Acidity:** high\\n**Body:** medium\\n**Alcohol:** medium to medium(+)\\n\\n**Fruit aromas:**\\n* citrus fruits: lemon, lime, grapefruit\\n* green fruit: green apple, pear\\n* stone fruit: peach, apricot (in riper examples)\\n\\n**Other aromas:**\\n* floral: white flowers, orange blossom\\n* mineral: wet stone, granite, sea spray\\n* herbal: fennel, fresh herbs\\n* other: saline, iodine, almond\\n\\n**Aromas from bottle aging:**\\n* nutty: almond, hazelnut\\n* mineral: petrol (in extended aging)\\n* dried fruit: dried apple, honey\\n\\n## Other grape varieties you might like\\nIf you enjoy Albariño, try these varieties:\\n* [Riesling](/varieties/riesling) - Similar high acidity and mineral character\\n* [Muscadet](/varieties/muscadet) - Comparable saline quality and seafood affinity\\n* [Vermentino](/varieties/vermentino) - Similar coastal expression and citrus profile\\n* [Grüner Veltliner](/varieties/gruener-veltliner) - Comparable mineral-driven style\\n* [Assyrtiko](/varieties/assyrtiko) - Similar high acidity and mineral intensity\n</ideal_output>\n</example>\n</examples>\n\n",
          },
          {
            type: 'file',
            mimeType: 'application/pdf',
            data: 'https://www.wsetglobal.com/media/3119/wset_l3_wines_sat_en_jun-2016.pdf',
          },
          {
            type: 'text',
            text: `\nYou are tasked with writing a concise guide for a specific grape variety. Follow these instructions carefully to create an informative and well-structured guide:\n\n1. The grape variety you will be writing about is:\n<grape_variety>\n${variety}\n</grape_variety>\n\n2. Write your guide in markdown format, following this structure:\n   a. Start with a level 1 heading (#) of the grape variety name\n   b. Include a brief description (1-2 lines) of key characteristics\n   c. Use level 2 headings (##) for the following sections:\n      - Growing Regions\n      - Wine Styles\n      - Tasting Profile\n   d. Under the Tasting Profile section, use bold text for subsections like Color spectrum, Acidity, Body, and types of aromas\n\n3. When mentioning other grape varieties, wrap them in a link with the following format: [Variety Name](/varieties/variety-name). For example: [Chardonnay](/varieties/chardonnay). Do not wrap the main grape variety you are writing about in a link.\n\n4. Avoid using superlative terms such as \"the king of grapes\" or \"finds its spiritual home in\".\n\n5. Conclude your guide with a section titled \"Other grape varieties you might like\". List 3 recommended varietals that are grown in the same region or have similar characteristics to the main grape variety. Format these as a bulleted list with links, as described in point 3.\n\n6. Ensure your guide follows a similar structure and level of detail as the example provided for Riesling, Gamay & Albariñho.`,
          },
        ],
      },
    ],
  });

  return text;
}

export async function generateSummary(variety: string) {
  const { text } = await generateText({
    model: anthropic('claude-4-sonnet-20250514'),
    temperature: 1,
    messages: [
      {
        role: 'user',
        content: [
          {
            type: 'text',
            text: "<examples>\n<example>\n<GRAPE_VARIETY>\nMalbec\n</GRAPE_VARIETY>\n<ideal_output>\nArgentina's adopted red grape. Blueberry Cake. Spicy and rich in Argentina, gamay in Cahors.\n</ideal_output>\n</example>\n<example>\n<GRAPE_VARIETY>\nChenin Blanc\n</GRAPE_VARIETY>\n<ideal_output>\nExtremely versatile: honey, damp straw, apple characters.\n</ideal_output>\n</example>\n<example>\n<GRAPE_VARIETY>\nSangiovese\n</GRAPE_VARIETY>\n<ideal_output>\nItaly's most-planted red grape. Tangy, lively, fairly pale, variable flavors: from prunes to farmyard\n</ideal_output>\n</example>\n<example>\n<GRAPE_VARIETY>\nSyrah\n</GRAPE_VARIETY>\n<ideal_output>\nHome to the Northern Rhône, now planted all around the globe. Dense and rich with the signature savory kick: dark fruit, black pepper, dark chocolate, notable tannin.\n</ideal_output>\n</example>\n</examples>\n\n",
          },
          {
            type: 'text',
            text: `You are a wine expert. Your task is to create a concise, one-sentence statement of a grape variety\nHere is the grape variety\n<grape_variety\n${variety}\n</grape_variety>\n\nTo create your summary, follow these guidelines:\n1. Your summary should be concise yet comprehensive, capturing the essence of the grape varietal in about 10-15 words.\n\n4. Focus on the grape\'s primary characteristics, such as its flavor profile, acidity, body, or any unique qualities that set it apart from other varietals.\n\n5. If relevant, you may mention a place or country associated with the grape variety. This should only be included if it\'s particularly significant or helps to define the grape\'s identity.\n\n6. Follow the style of the provided examples.\n\n7. Avoid using phrases like "This grape is..." or "Known for...". Instead, aim for a more direct and impactful description.\n\n8. Avoid superlatives like "The king of grapes" or "The world\'s most...".\n\nOnce you have crafted your summary, simply return it as a string\n\nRemember, your goal is to create a concise yet informative summary that captures the essence of the grape varietal in a single, well-crafted sentence.`,
          },
        ],
      },
    ],
  });

  return text;
}
